################################################################################
## cfg                                                                        ##
################################################################################
## Libraries etc
source('cfg.r')
sourceAllLibs('src/weather/')

## paths and parameters
dir   = 'data/cru_ts3.23/'
varns = c(vap    = 'vap',
          temp   = 'tmp')

clim_layers = 73:288

################################################################################
## load data                                                                  ##
################################################################################
c(dat, nyears) := loadClimDat

################################################################################
##                                                          ##
################################################################################

make_emc <- function(i) {
	Vap = dat[[1]][[i]]
	Tas = dat[[2]][[i]]
	Hr = realtive_humidity(Tas, Vap)
	emc = fuel_moisture_equilibrium(0, Hr, Tas)
}


emc = layer.apply(1:(12*nyears), make_emc)

################################################################################
## run and output                                                             ##
################################################################################


writeRaster.gitInfo(emc, drive_fname['emc'], overwrite = TRUE)
